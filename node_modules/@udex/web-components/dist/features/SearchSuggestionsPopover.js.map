{"version":3,"file":"SearchSuggestionsPopover.js","sourceRoot":"","sources":["../../src/features/SearchSuggestionsPopover.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,eAAe,EAAE,MAAM,kDAAkD,CAAC;AACnF,OAAO,MAAM,MAAM,mCAAmC,CAAC;AACvD,OAAO,OAAO,MAAM,oCAAoC,CAAC;AAazD;;;;;;GAMG;AACH,MAAM,UAAU;IAKd,YAAY,SAA8B;QACxC,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAC7B,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC;IAC9B,CAAC;IAED,aAAa;QACX,OAAO,IAAI,CAAC,SAAS,CAAC;IACxB,CAAC;IAED,KAAK,CAAC,qBAAqB;QACzB,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,OAAO,IAAI,CAAC,OAAO,CAAC;SACrB;QAED,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC,uBAAuB,EAAE,CAAC;QAC5E,IAAI,CAAC,OAAO,GAAG,cAAe,CAAC,aAAa,CAAU,eAAe,CAAC,CAAC;QACvE,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,EAAE,gBAAgB,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IACjF,CAAC;IAED,IAAI;QACF,IAAI,CAAC,aAAa,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC;QACjC,IAAI,CAAC,OAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;IAC7C,CAAC;IAED,KAAK;QACH,IAAI,CAAC,aAAa,EAAE,CAAC,IAAI,GAAG,KAAK,CAAC;QAClC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;QAC1B,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC;IAC9B,CAAC;IAED,YAAY;QACV,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,aAAa,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,CAAC;QAC3D,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC;IAC9B,CAAC;IAED,OAAO,CAAC,CAAgB;QACtB,CAAC,CAAC,cAAc,EAAE,CAAC;QACnB,IAAI,IAAI,CAAC,iBAAiB,IAAI,CAAC,EAAE;YAC/B,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,EAAE,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;SAClH;IACH,CAAC;IAED,KAAK,CAAC,CAAgB;QACpB,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;IACjB,CAAC;IAED,aAAa,CAAC,CAAgB;QAC5B,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IACf,CAAC;IAED,IAAI,CAAC,CAAgB;QACnB,CAAC,CAAC,cAAc,EAAE,CAAC;QACnB,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC,MAAM,EAAE;YAC3B,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC;YAC9C,MAAM,mBAAmB,GAAG,IAAI,CAAC,iBAAiB,CAAC;YAEnD,IAAI,mBAAmB,KAAK,CAAC,CAAC,EAAE;gBAC7B,IAAI,CAAC,SAAS,EAAE,CAAC,SAAS,CAAiB,CAAC,KAAK,EAAE,CAAC;gBACrD,IAAI,CAAC,iBAAiB,GAAG,SAAS,CAAC;gBACnC,OAAO,IAAI,CAAC;aACb;YACD,IAAI,mBAAmB,GAAG,CAAC,IAAI,mBAAmB,IAAI,SAAS,EAAE;gBAC9D,IAAI,CAAC,SAAS,EAAE,CAAC,mBAAmB,GAAG,CAAC,CAAiB,CAAC,KAAK,EAAE,CAAC;gBACnE,IAAI,CAAC,iBAAiB,GAAG,mBAAmB,GAAG,CAAC,CAAC;gBACjD,OAAO,IAAI,CAAC;aACb;YACD,IAAI,mBAAmB,KAAK,CAAC,EAAE;gBAC7B,IAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,OAAO,IAAI,CAAC;aACb;SACF;IACH,CAAC;IAED,MAAM,CAAC,CAAgB;QACrB,CAAC,CAAC,cAAc,EAAE,CAAC;QACnB,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC,MAAM,EAAE;YAC3B,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC;YAC9C,MAAM,eAAe,GAAG,IAAI,CAAC,iBAAiB,CAAC;YAE/C,IAAI,eAAe,KAAK,CAAC,CAAC,EAAE;gBACzB,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAiB,CAAC,KAAK,EAAE,CAAC;gBAC7C,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC;gBAC3B,OAAO,IAAI,CAAC;aACb;YACD,IAAI,eAAe,IAAI,CAAC,IAAI,eAAe,KAAK,SAAS,EAAE;gBACxD,IAAI,CAAC,SAAS,EAAE,CAAC,eAAe,GAAG,CAAC,CAAiB,CAAC,KAAK,EAAE,CAAC;gBAC/D,IAAI,CAAC,iBAAiB,GAAG,eAAe,GAAG,CAAC,CAAC;gBAC7C,OAAO,IAAI,CAAC;aACb;YACD,IAAI,eAAe,KAAK,SAAS,EAAE;gBACjC,IAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,OAAO,IAAI,CAAC;aACb;SACF;IACH,CAAC;IAED,OAAO;QACL,IAAI,CAAC,YAAY,EAAE,CAAC;IACtB,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,YAAY,EAAE,CAAC;IACtB,CAAC;IAED,QAAQ,CAAC,CAAgB;QACvB,CAAC,CAAC,cAAc,EAAE,CAAC;QACnB,IAAI,CAAC,KAAK,EAAE,CAAC;IACf,CAAC;IAED,MAAM,KAAK,YAAY;QACrB,OAAO;YACL,OAAO;YACP,MAAM;SACP,CAAC;IACJ,CAAC;CACF;AAED,eAAe,CAAC,uBAAuB,EAAE,UAAU,CAAC,CAAC;AAErD,eAAe,UAAU,CAAC","sourcesContent":["import type UI5Element from \"@ui5/webcomponents-base/dist/UI5Element\";\nimport { registerFeature } from \"@ui5/webcomponents-base/dist/FeaturesRegistry.js\";\nimport Button from \"@ui5/webcomponents/dist/Button.js\";\nimport Popover from \"@ui5/webcomponents/dist/Popover.js\";\n\ninterface SuggestionComponent extends UI5Element {\n  open: boolean;\n  value?: string;\n  suggestionItems?: string;\n}\n\ntype SearchInputSuggestion = {\n  handleSelectItem: () => void;\n  text: string;\n}\n\n/**\n * A class to manage the <code>Search</code suggestion items.\n *\n * @class\n * @private\n * @author SAP SE\n */\nclass Suggestion {\n  component: SuggestionComponent;\n  popover?: Popover | null;\n  selectedItemIndex: number;\n\n  constructor(component: SuggestionComponent) {\n    this.component = component;\n    this._getSuggestionPopover();\n    this.selectedItemIndex = -1;\n  }\n\n  _getComponent(): SuggestionComponent {\n    return this.component;\n  }\n\n  async _getSuggestionPopover() {\n    if (this.popover) {\n      return this.popover;\n    }\n\n    const staticAreaItem = await this._getComponent().getStaticAreaItemDomRef();\n    this.popover = staticAreaItem!.querySelector<Popover>(\"[ui5-popover]\");\n    return this.popover;\n  }\n\n  _getItems() {\n    return this.popover ? [...this.popover?.querySelectorAll(\"[ui5-button]\")] : [];\n  }\n\n  open(): void {\n    this._getComponent().open = true;\n    this.popover!.showAt(this._getComponent());\n  }\n\n  close(): void {\n    this._getComponent().open = false;\n    this.popover?.close(true);\n    this.selectedItemIndex = -1;\n  }\n\n  onFocusInput(): void {\n    this.component.shadowRoot?.querySelector(\"input\")?.focus();\n    this.selectedItemIndex = -1;\n  }\n\n  onEnter(e: KeyboardEvent) {\n    e.preventDefault();\n    if (this.selectedItemIndex >= 0) {\n      this.component.value = this._getItems()[this.selectedItemIndex].getAttribute(\"title\")?.replace(/<[^>]*>?/gm, \"\");\n    }\n  }\n\n  onTab(e: KeyboardEvent) {\n    this.onDown(e);\n  }\n\n  onTabPrevious(e: KeyboardEvent) {\n    this.onUp(e);\n  }\n\n  onUp(e: KeyboardEvent) {\n    e.preventDefault();\n    if (this._getItems().length) {\n      const itemCount = this._getItems().length - 1;\n      const previousSelectedIdx = this.selectedItemIndex;\n\n      if (previousSelectedIdx === -1) {\n        (this._getItems()[itemCount] as HTMLElement).focus();\n        this.selectedItemIndex = itemCount;\n        return true;\n      }\n      if (previousSelectedIdx > 0 && previousSelectedIdx <= itemCount) {\n        (this._getItems()[previousSelectedIdx - 1] as HTMLElement).focus();\n        this.selectedItemIndex = previousSelectedIdx - 1;\n        return true;\n      }\n      if (previousSelectedIdx === 0) {\n        this.onFocusInput();\n        return true;\n      }\n    }\n  }\n\n  onDown(e: KeyboardEvent) {\n    e.preventDefault();\n    if (this._getItems().length) {\n      const itemCount = this._getItems().length - 1;\n      const nextSelectedIdx = this.selectedItemIndex;\n\n      if (nextSelectedIdx === -1) {\n        (this._getItems()[0] as HTMLElement).focus();\n        this.selectedItemIndex = 0;\n        return true;\n      }\n      if (nextSelectedIdx >= 0 && nextSelectedIdx !== itemCount) {\n        (this._getItems()[nextSelectedIdx + 1] as HTMLElement).focus();\n        this.selectedItemIndex = nextSelectedIdx + 1;\n        return true;\n      }\n      if (nextSelectedIdx === itemCount) {\n        this.onFocusInput();\n        return true;\n      }\n    }\n  }\n\n  onRight() {\n    this.onFocusInput();\n  }\n\n  onLeft() {\n    this.onFocusInput();\n  }\n\n  onEscape(e: KeyboardEvent) {\n    e.preventDefault();\n    this.close();\n  }\n\n  static get dependencies() {\n    return [\n      Popover,\n      Button,\n    ];\n  }\n}\n\nregisterFeature(\"SearchInputSuggestion\", Suggestion);\n\nexport default Suggestion;\n\nexport type {\n  SuggestionComponent,\n  SearchInputSuggestion,\n};\n"]}